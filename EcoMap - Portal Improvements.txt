# EcoMap - Portal Improvements (Keeping 3-Role System)

**Goal:** Enhance Guest, Agent, and Admin experiences while maintaining current architecture

---

## üü¢ GUEST MODE IMPROVEMENTS

### **1. Remove Negative Labeling**
**Current:** Badge shows "GUEST" in caps (feels exclusionary)

**Better Options:**
```javascript
// Option A: Hide badge entirely for guests
if (currentUser.role === 'guest') {
    document.getElementById('user-badge').style.display = 'none';
}

// Option B: Positive label
document.getElementById('user-badge').textContent = 'Explorer';

// Option C: Welcoming message
document.getElementById('user-badge').textContent = 'üëã Welcome';
```

**Recommendation:** Hide badge for guests, only show for logged-in users

---

### **2. Add Feature Discovery Tooltips**
**Problem:** Guests don't know what they're missing

**Solution:** Persistent tooltips on first visit
```javascript
// Show on first load (use localStorage to track)
const firstVisit = !localStorage.getItem('ecomap_visited');

if (firstVisit && currentUser.role === 'guest') {
    showFeatureTour();
    localStorage.setItem('ecomap_visited', 'true');
}

function showFeatureTour() {
    const steps = [
        { element: '#search-input', text: 'Search for any location in Lahore' },
        { element: '.capsule-btn', text: 'Filter by container type' },
        { element: '#auth-btn', text: 'Login to add markers and earn rewards!' }
    ];
    
    // Simple tooltip overlay
    steps.forEach((step, index) => {
        setTimeout(() => {
            highlightElement(step.element, step.text);
        }, index * 2000);
    });
}
```

---

### **3. "Join EcoMap" Call-to-Action Banner**
**Add to top of map for guests:**
```html
<div id="guest-cta" class="guest-banner" style="display: none;">
    <div class="banner-content">
        <div class="banner-text">
            <strong>üåç Join EcoMap Community</strong>
            <span>Add locations, earn badges, and help clean Lahore!</span>
        </div>
        <button onclick="showLoginScreen()">Join Now</button>
        <button onclick="dismissBanner()" class="btn-text">Maybe Later</button>
    </div>
</div>

<style>
.guest-banner {
    position: absolute;
    top: 70px;
    left: 50%;
    transform: translateX(-50%);
    background: linear-gradient(135deg, #4CAF50, #81C784);
    color: white;
    padding: 15px 25px;
    border-radius: 15px;
    box-shadow: 0 4px 20px rgba(0,0,0,0.15);
    z-index: 2000;
    animation: slideDown 0.5s ease;
}

@keyframes slideDown {
    from { top: -50px; opacity: 0; }
    to { top: 70px; opacity: 1; }
}
</style>

<script>
// Show banner after 30 seconds of browsing
if (currentUser.role === 'guest') {
    setTimeout(() => {
        document.getElementById('guest-cta').style.display = 'flex';
    }, 30000);
}

function dismissBanner() {
    document.getElementById('guest-cta').style.display = 'none';
    localStorage.setItem('banner_dismissed', Date.now());
}
</script>
```

---

### **4. Feature Teaser Modals (Instead of Hard Blocks)**
**Current:** Features are hidden entirely

**Better:** Show features with upgrade prompts
```javascript
// Make (+) button visible to everyone
document.getElementById('mark-btn').style.display = 'flex'; // Always show

// But intercept clicks for guests
function toggleMarkMode() {
    if (currentUser.role === 'guest') {
        showFeatureTeaser('addMarker');
    } else {
        // Existing mark mode logic
        markMode = !markMode;
        // ...
    }
}

function showFeatureTeaser(featureName) {
    const teasers = {
        addMarker: {
            title: 'üéØ Add Locations',
            description: 'Help map Lahore by adding garbage containers you discover',
            benefits: ['Mark new spots', 'Earn 50 Eco-Credits per marker', 'Contribute to cleaner city'],
            action: 'Login to Add Markers'
        },
        earnPoints: {
            title: 'üèÜ Earn Rewards',
            description: 'Track your environmental impact with badges and points',
            benefits: ['Unlock badges', 'Compete on leaderboard', 'Track contributions'],
            action: 'Login to Start Earning'
        },
        editMarker: {
            title: '‚úèÔ∏è Edit Information',
            description: 'Keep our map accurate by updating marker details',
            benefits: ['Fix outdated info', 'Earn 25 Eco-Credits', 'Help community'],
            action: 'Login to Edit'
        }
    };
    
    const teaser = teasers[featureName];
    
    const modal = document.createElement('div');
    modal.innerHTML = `
        <div class="teaser-overlay" onclick="this.remove()">
            <div class="teaser-card" onclick="event.stopPropagation()">
                <div class="teaser-header">
                    <h2>${teaser.title}</h2>
                    <p>${teaser.description}</p>
                </div>
                
                <div class="teaser-benefits">
                    ${teaser.benefits.map(b => `
                        <div class="benefit-item">
                            <i class="fa-solid fa-check-circle" style="color:#4CAF50;"></i>
                            <span>${b}</span>
                        </div>
                    `).join('')}
                </div>
                
                <div class="teaser-actions">
                    <button class="btn-save" onclick="showLoginScreen(); this.closest('.teaser-overlay').remove();">
                        ${teaser.action}
                    </button>
                    <button class="btn-secondary" onclick="this.closest('.teaser-overlay').remove()">
                        Continue Browsing
                    </button>
                </div>
                
                <p class="teaser-footer">
                    No account? <a href="#" onclick="showSignUpForm()">Sign up in 30 seconds</a>
                </p>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal.firstElementChild);
}
```

**CSS:**
```css
.teaser-overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(5px);
    z-index: 6000;
    display: flex;
    align-items: center;
    justify-content: center;
    animation: fadeIn 0.3s;
}

.teaser-card {
    background: white;
    border-radius: 20px;
    padding: 30px;
    max-width: 450px;
    width: 90%;
    box-shadow: 0 10px 40px rgba(0,0,0,0.3);
    animation: slideUp 0.4s;
}

.teaser-benefits {
    margin: 20px 0;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

.benefit-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px;
    background: #f5f5f5;
    border-radius: 8px;
}

@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideUp {
    from { transform: translateY(50px); opacity: 0; }
    to { transform: translateY(0); opacity: 1; }
}
```

---

### **5. Guest-Friendly Info Panel Enhancements**
**Add value even without login:**

```javascript
function showMarkerDetails(marker) {
    const distance = calculateDistance(userLat, userLng, marker.lat, marker.lng);
    
    const guestActions = currentUser.role === 'guest' ? `
        <div class="guest-actions-hint" style="background:#fff3cd; padding:15px; border-radius:10px; margin-top:15px; border-left:4px solid #ffc107;">
            <strong>üí° Want to do more?</strong>
            <p style="font-size:0.9rem; margin:8px 0;">Login to report issues, add markers, and earn Eco-Credits!</p>
            <button class="btn-save" onclick="showLoginScreen()" style="width:auto; padding:8px 20px;">
                Login Now
            </button>
        </div>
    ` : `
        <div class="action-buttons-row">
            <button class="btn-action btn-report" onclick="openReportModal(${JSON.stringify(marker)})">
                <i class="fa-solid fa-flag"></i> Report
            </button>
            <button class="btn-action btn-share" onclick="shareMarker(${marker.id})">
                <i class="fa-solid fa-share"></i> Share
            </button>
        </div>
    `;
    
    document.getElementById('panel-content').innerHTML = `
        <div class="panel-hero-view">
            <i class="fa-solid ${marker.type === 'Garbage Containers' ? 'fa-trash-can' : 'fa-dumpster'}"></i>
        </div>
        <div class="panel-body">
            <h2 class="panel-title">${marker.title}</h2>
            <p><strong>Type:</strong> ${marker.type}</p>
            <p><strong>Address:</strong> ${marker.address}</p>
            ${distance ? `<p><strong>Distance:</strong> ${distance} km away</p>` : ''}
            <p><strong>Last Verified:</strong> ${marker.lastVerified}</p>
            ${marker.notes ? `<p><strong>Notes:</strong> ${marker.notes}</p>` : ''}
            
            <button class="btn-save" onclick="showRoute(${JSON.stringify(marker)})">
                <i class="fa-solid fa-route"></i> Get Directions
            </button>
            
            ${guestActions}
        </div>
    `;
    
    document.getElementById('info-panel').classList.remove('hidden');
}
```

---

### **6. Guest Chatbot Personality Enhancement**
**Make chatbot subtly encourage joining:**

```javascript
function getBotResponse(message) {
    // ... existing logic ...
    
    // Add guest-specific responses
    if (currentUser.role === 'guest') {
        const joinPrompts = [
            "login", "account", "sign up", "register", "join",
            "add marker", "earn points", "badges", "leaderboard"
        ];
        
        if (joinPrompts.some(prompt => message.includes(prompt))) {
            return `Great question! Logging in unlocks:\n
                    ‚úÖ Add new locations (+50 credits each)\n
                    ‚úÖ Earn badges and climb the leaderboard\n
                    ‚úÖ Report issues and help the community\n
                    \nClick the user icon at the bottom of the sidebar to login!`;
        }
    }
    
    // ... rest of chatbot logic ...
}
```

---

### **7. Progressive Web App (PWA) Prompt**
**For guests who engage heavily:**

```javascript
// Track guest engagement
let guestInteractions = 0;

map.on('click', () => guestInteractions++);
document.getElementById('search-input').addEventListener('input', () => guestInteractions++);

// After 10 interactions, suggest PWA install
if (guestInteractions >= 10 && currentUser.role === 'guest') {
    showPWAPrompt();
}

function showPWAPrompt() {
    showToast("üí° Tip: Add EcoMap to your home screen for quick access!", 5000);
}
```

---

## üîµ AGENT MODE IMPROVEMENTS

### **1. Personalized Welcome Message**
**Show impact on login:**

```javascript
function login() {
    const u = document.getElementById('login-user').value;
    const p = document.getElementById('login-pass').value;
    
    if (users[u] && users[u].password === p) {
        currentUser = { 
            role: users[u].role, 
            username: u,
            points: loadUserPoints(u) || 0,
            level: 1,
            badges: []
        };
        
        updateUI();
        document.getElementById('login-screen').classList.add('hidden');
        
        // Enhanced welcome
        showWelcomeCard();
        saveUserData();
    }
}

function showWelcomeCard() {
    const stats = getUserStats(currentUser.username);
    
    const welcomeHTML = `
        <div class="welcome-card" style="position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:white; padding:30px; border-radius:20px; box-shadow:0 10px 40px rgba(0,0,0,0.2); z-index:5500; text-align:center; animation:popIn 0.5s;">
            <div style="font-size:3rem; margin-bottom:10px;">üëã</div>
            <h2 style="margin-bottom:10px;">Welcome back, ${currentUser.username}!</h2>
            
            <div style="display:grid; grid-template-columns:1fr 1fr 1fr; gap:15px; margin:20px 0;">
                <div style="background:#f5f5f5; padding:15px; border-radius:10px;">
                    <div style="font-size:1.8rem; font-weight:bold; color:#4CAF50;">${stats.markersAdded}</div>
                    <div style="font-size:0.85rem; color:#666;">Markers Added</div>
                </div>
                <div style="background:#f5f5f5; padding:15px; border-radius:10px;">
                    <div style="font-size:1.8rem; font-weight:bold; color:#4CAF50;">${currentUser.points}</div>
                    <div style="font-size:0.85rem; color:#666;">Eco-Credits</div>
                </div>
                <div style="background:#f5f5f5; padding:15px; border-radius:10px;">
                    <div style="font-size:1.8rem; font-weight:bold; color:#4CAF50;">Level ${currentUser.level}</div>
                    <div style="font-size:0.85rem; color:#666;">Current Level</div>
                </div>
            </div>
            
            <p style="color:#666; font-size:0.9rem; margin-bottom:20px;">Ready to make Lahore cleaner? üå±</p>
            
            <button class="btn-save" onclick="closeWelcomeCard()" style="width:auto; padding:10px 30px;">
                Let's Go!
            </button>
        </div>
        <div class="welcome-overlay" onclick="closeWelcomeCard()" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:5400;"></div>
    `;
    
    const div = document.createElement('div');
    div.id = 'welcome-container';
    div.innerHTML = welcomeHTML;
    document.body.appendChild(div);
    
    // Auto-close after 5 seconds
    setTimeout(closeWelcomeCard, 5000);
}

function closeWelcomeCard() {
    const container = document.getElementById('welcome-container');
    if (container) container.remove();
}

@keyframes popIn {
    0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
    100% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
}
```

---

### **2. Quick Actions Dashboard**
**Add floating widget for agents:**

```html
<div id="agent-dashboard" class="hidden" style="position:fixed; top:80px; right:20px; background:white; padding:15px; border-radius:15px; box-shadow:0 4px 20px rgba(0,0,0,0.15); z-index:2500; width:200px;">
    <h4 style="margin:0 0 12px 0; font-size:0.95rem; color:#666;">Quick Actions</h4>
    
    <div class="quick-action" onclick="toggleMarkMode()">
        <i class="fa-solid fa-plus-circle" style="color:#4CAF50;"></i>
        <span>Add Marker</span>
    </div>
    
    <div class="quick-action" onclick="openGamificationModal()">
        <i class="fa-solid fa-trophy" style="color:#FFB300;"></i>
        <span>View Profile</span>
    </div>
    
    <div class="quick-action" onclick="showMyMarkers()">
        <i class="fa-solid fa-list" style="color:#2196F3;"></i>
        <span>My Markers</span>
    </div>
    
    <div class="quick-action" onclick="toggleDashboard()">
        <i class="fa-solid fa-times" style="color:#999;"></i>
        <span>Close</span>
    </div>
</div>

<style>
.quick-action {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 10px;
    border-radius: 8px;
    cursor: pointer;
    transition: background 0.2s;
    font-size: 0.9rem;
}

.quick-action:hover {
    background: #f5f5f5;
}
</style>

<script>
// Show dashboard for agents
function updateUI() {
    // ... existing code ...
    
    const dashboard = document.getElementById('agent-dashboard');
    if (currentUser.role === 'agent' || currentUser.role === 'admin') {
        dashboard.classList.remove('hidden');
    } else {
        dashboard.classList.add('hidden');
    }
}

function toggleDashboard() {
    document.getElementById('agent-dashboard').classList.toggle('hidden');
}
</script>
```

---

### **3. "My Markers" View**
**Let agents see their contributions:**

```javascript
function showMyMarkers() {
    const myMarkers = getAllMapData().filter(m => 
        m.addedBy === currentUser.username || m.submittedBy === currentUser.username
    );
    
    if (myMarkers.length === 0) {
        showToast("You haven't added any markers yet. Click (+) to start!");
        return;
    }
    
    const content = `
        <div class="panel-body">
            <h2 class="panel-title">My Contributions</h2>
            <p style="color:#666; margin-bottom:20px;">${myMarkers.length} locations added</p>
            
            <div class="markers-list">
                ${myMarkers.map((m, index) => `
                    <div class="marker-item" onclick="focusMarker(${m.id})" style="padding:12px; border-bottom:1px solid #eee; cursor:pointer; transition:background 0.2s;">
                        <div style="display:flex; gap:12px; align-items:center;">
                            <div style="font-size:1.5rem;">
                                ${m.type === 'Garbage Containers' ? 'üóëÔ∏è' : m.type === 'Korgans' ? '‚ôªÔ∏è' : 'üöõ'}
                            </div>
                            <div style="flex:1;">
                                <strong>${m.title}</strong>
                                <div style="font-size:0.85rem; color:#666;">${m.address}</div>
                                <div style="font-size:0.8rem; color:#999; margin-top:4px;">Added: ${m.lastVerified}</div>
                            </div>
                            <i class="fa-solid fa-chevron-right" style="color:#ccc;"></i>
                        </div>
                    </div>
                `).join('')}
            </div>
            
            <div style="background:#f5f5f5; padding:15px; border-radius:10px; margin-top:20px; text-align:center;">
                <strong style="color:#4CAF50; font-size:1.2rem;">+${myMarkers.length * 50}</strong>
                <div style="font-size:0.9rem; color:#666; margin-top:5px;">Eco-Credits Earned</div>
            </div>
        </div>
    `;
    
    document.getElementById('panel-content').innerHTML = content;
    document.getElementById('info-panel').classList.remove('hidden');
}

function focusMarker(markerId) {
    const marker = getAllMapData().find(m => m.id === markerId);
    if (marker) {
        map.setView([marker.lat, marker.lng], 18);
        showMarkerDetails(marker);
    }
}
```

---

### **4. Contribution Streaks**
**Motivate regular engagement:**

```javascript
function checkContributionStreak() {
    const lastContribution = localStorage.getItem('last_contribution_date');
    const today = new Date().toDateString();
    
    if (lastContribution) {
        const lastDate = new Date(lastContribution);
        const daysDiff = Math.floor((new Date() - lastDate) / (1000 * 60 * 60 * 24));
        
        if (daysDiff === 1) {
            // Consecutive day
            currentUser.streak = (currentUser.streak || 0) + 1;
            showToast(`üî• ${currentUser.streak} day streak! Keep it going!`);
        } else if (daysDiff > 1) {
            // Streak broken
            currentUser.streak = 0;
        }
    }
    
    localStorage.setItem('last_contribution_date', today);
    saveUserData();
}

// Call when agent adds marker
function saveMarker(lat, lng) {
    // ... existing save logic ...
    
    if (currentUser.role !== 'guest') {
        checkContributionStreak();
        awardPoints(50, "Adding a marker");
    }
}
```

---

### **5. Batch Add Mode**
**For agents adding multiple locations:**

```javascript
let batchAddMode = false;
let batchMarkers = [];

function toggleBatchAdd() {
    batchAddMode = !batchAddMode;
    
    if (batchAddMode) {
        showToast("Batch mode ON: Click multiple locations, then save all at once");
        map.getContainer().style.cursor = 'crosshair';
    } else {
        showToast("Batch mode OFF");
        map.getContainer().style.cursor = '';
    }
}

map.on('click', function(e) {
    if (batchAddMode && currentUser.role !== 'guest') {
        const { lat, lng } = e.latlng;
        
        // Add temporary marker
        const tempMarker = L.marker([lat, lng], {
            icon: L.divIcon({
                className: 'temp-marker',
                html: '<div style="background:#ffc107; width:20px; height:20px; border-radius:50%; border:3px solid white;"></div>'
            })
        }).addTo(map);
        
        batchMarkers.push({ lat, lng, marker: tempMarker });
        showToast(`Added ${batchMarkers.length} location(s). Click 'Save Batch' when done.`);
    }
});

function saveBatchMarkers() {
    if (batchMarkers.length === 0) {
        showToast("No markers to save");
        return;
    }
    
    // Show form for batch details
    showBatchForm(batchMarkers);
}

function showBatchForm(markers) {
    const content = `
        <div class="panel-body">
            <h2 class="panel-title">Save ${markers.length} Markers</h2>
            
            <div class="form-group">
                <label>Type (applies to all)</label>
                <select id="batch-type" class="form-control">
                    <option value="Garbage Containers">Garbage Containers</option>
                    <option value="Dumping Yard">Dumping Yard</option>
                    <option value="Korgans">Korgans</option>
                </select>
            </div>
            
            <div class="form-group">
                <label>Area/Neighborhood</label>
                <input type="text" id="batch-area" class="form-control" placeholder="e.g., Gulberg III">
            </div>
            
            <div class="form-group">
                <label>Additional Notes</label>
                <textarea id="batch-notes" class="form-control" rows="3"></textarea>
            </div>
            
            <button class="btn-save" onclick="confirmBatchSave()">
                Save ${markers.length} Markers (+${markers.length * 50} credits)
            </button>
            
            <button class="btn-save" style="background:#e74c3c; margin-top:10px;" onclick="cancelBatch()">
                Cancel Batch
            </button>
        </div>
    `;
    
    document.getElementById('panel-content').innerHTML = content;
    document.getElementById('info-panel').classList.remove('hidden');
}

function confirmBatchSave() {
    const type = document.getElementById('batch-type').value;
    const area = document.getElementById('batch-area').value;
    const notes = document.getElementById('batch-notes').value;
    
    batchMarkers.forEach((item, index) => {
        const newMarker = {
            id: markersData.length + index + 1,
            type: type,
            lat: item.lat,
            lng: item.lng,
            title: `${type} - ${area} #${index + 1}`,
            address: area,
            notes: notes,
            lastVerified: new Date().toISOString().split('T')[0],
            addedBy: currentUser.username
        };
        
        // Add to data
        if (type === 'Garbage Containers') {
            containersData.push(newMarker);
        } else if (type === 'Korgans') {
            korgansData.push(newMarker);
        } else {
            markersData.push(newMarker);
        }
        
        // Remove temp marker
        map.removeLayer(item.marker);
    });
    
    // Award points
    awardPoints(batchMarkers.length * 50, `Adding ${batchMarkers.length} markers`);
    
    // Clear batch
    batchMarkers = [];
    batchAddMode = false;
    
    // Reload map
    loadMarkers();
    closePanel();
    
    showToast(`Successfully added ${batchMarkers.length} markers! üéâ`);
}
```

---

### **6. Agent-Specific Chatbot Responses**
**Personalized help for agents:**

```javascript
function getBotResponse(message) {
    // ... existing logic ...
    
    // Agent-specific tips
    if (currentUser.role === 'agent' || currentUser.role === 'admin') {
        if (message.includes('tip') || message.includes('help') || message.includes('how')) {
            const tips = [
                "üí° Tip: Use batch mode to add multiple markers at once! Click the batch icon.",
                "üí° Tip: You earn 50 credits per marker. Add 10 to reach Level 2!",
                "üí° Tip: Click 'My Markers' to see all locations you've added.",
                "üí° Tip: Verify marker accuracy to earn bonus credits!",
                "üí° Tip: Report issues to help the community and earn 25 credits."
            ];
            return tips[Math.floor(Math.random() * tips.length)];
        }
    }
    
    // ... rest of chatbot logic ...
}
```

---

## ‚ö´ ADMIN MODE IMPROVEMENTS

### **1. Admin Dashboard Widget**
**Quick stats overlay:**

```html
<div id="admin-panel" class="hidden" style="position:fixed; top:80px; left:20px; background:white; padding:20px; border-radius:15px; box-shadow:0 4px 20px rgba(0,0,0,0.15); z-index:2500; width:280px;">
    <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px;">
        <h4 style="margin:0; font-size:1rem;">Admin Dashboard</h4>
        <button onclick="toggleAdminPanel()" style="background:none; border:none; cursor:pointer;">
            <i class="fa-solid fa-times"></i>
        </button>
    </div>
    
    <div class="admin-stat">
        <div class="stat-value" id="total-markers">0</div>
        <div class="stat-label">Total Markers</div>
    </div>
    
    <div class="admin-stat">
        <div class="stat-value" id="pending-reports">0</div>
        <div class="stat-label">Pending Reports</div>
    </div>
    
    <div class="admin-stat">
        <div class="stat-value" id="active-users">3</div>
        <div class="stat-label">Active Users</div>
    </div>
    
    <hr style="margin:15px 0; border:none; border-top:1px solid #eee;">
    
    <button class="admin-action" onclick="showAllReports()">
        <i class="fa-solid fa-flag"></i> View Reports
    </button>
    
    <button class="admin-action" onclick="exportData()">
        <i class="fa-solid fa-download"></i> Export Data
    </button>
    
    <button class="admin-action" onclick="showUserManagement()">
        <i class="fa-solid fa-users"></i> Manage Users
    </button>
</div>

<style>
.admin-stat {
    background: #f5f5f5;
    padding: 12px;
    border-radius: 10px;
    margin-bottom: 10px;
    text-align: center;
}

.stat-value {
    font-size: 1.8rem;
    font-weight: bold;
    color: #212121;
}

.stat-label {
    font-size: 0.85rem;
    color: #666;
    margin-top: 4px;
}

.admin-action {
    width: 100%;
    padding: 10px;
    background: #f5f5f5;
    border: none;
    border-radius: 8px;
    margin-bottom: 8px;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 10px;
    transition: background 0.2s;
    font-size: 0.9rem;
}

.admin-action:hover {
    background: #e0e0e0;
}
</style>

<script>
function updateUI() {
    // ... existing code ...
    
    if (currentUser.role === 'admin') {
        document.getElementById('admin-panel').classList.remove('hidden');
        updateAdminStats();
    } else {
        document.getElementById('admin-panel').classList.add('hidden');
    }
}

function updateAdminStats() {
    const totalMarkers = markersData.length + korgansData.length + containersData.length;
    document.getElementById('total-markers').textContent = totalMarkers;
    
    // Get pending reports from localStorage
    const reports = JSON.parse(localStorage.getItem('reports') || '[]');
    const pending = reports.filter(r => r.status !== 'resolved').length;
    document.getElementById('pending-reports').textContent = pending;
}

function toggleAdminPanel() {
    document.getElementById('admin-panel').classList.toggle('hidden');
}
</script>
```

---

### **2. Bulk Delete Mode**
**For cleaning up spam/invalid markers:**

```javascript
let bulkDeleteMode = false;
let selectedMarkers = [];

function toggleBulkDelete() {
    bulkDeleteMode = !bulkDeleteMode;
    selectedMarkers = [];
    
    if (bulkDeleteMode) {
        showToast("Bulk delete ON: Click markers to select, then confirm deletion");
        document.querySelectorAll('.leaflet-marker-icon').forEach(marker => {
            marker.style.opacity = '0.6';
        });
    } else {
        showToast("Bulk delete OFF");
        document.querySelectorAll('.leaflet-marker-icon').forEach(marker => {
            marker.style.opacity = '1';
        });
    }
}

// Override marker click in bulk delete mode
map.on('click', function(e) {
    if (bulkDeleteMode && currentUser.role === 'admin') {
        // Find closest marker
        const clickedMarker = findNearestMarker(e.latlng);
        
        if (clickedMarker) {
            const index = selectedMarkers.findIndex(m => m.id === clickedMarker.id);
            
            if (index === -1) {
                selectedMarkers.push(clickedMarker);
                showToast(`Selected ${selectedMarkers.length} marker(s)`);
            } else {
                selectedMarkers.splice(index, 1);
                showToast(`Deselected. ${selectedMarkers.length} marker(s) selected`);
            }
        }
    }
});

function confirmBulkDelete() {
    if (selectedMarkers.length === 0) {
        showToast("No markers selected");
        return;
    }
    
    const confirmMsg = `Delete ${selectedMarkers.length} markers? This cannot be undone.`;
    
    if (confirm(confirmMsg)) {
        selectedMarkers.forEach(marker => {
            deleteMarker(marker.id);
        });
        
        showToast(`Deleted ${selectedMarkers.length} markers`);
        selectedMarkers = [];
        bulkDeleteMode = false;
        loadMarkers();
    }
}
```

---

### **3. Data Export Function**
**Download all markers as JSON/CSV:**

```javascript
function exportData() {
    const allData = getAllMapData();
    
    const exportOptions = `
        <div class="export-modal">
            <h3>Export EcoMap Data</h3>
            <p>${allData.length} total locations</p>
            
            <button onclick="downloadJSON()" class="btn-save">
                <i class="fa-solid fa-file-code"></i> Export as JSON
            </button>
            
            <button onclick="downloadCSV()" class="btn-save" style="background:#34a853;">
                <i class="fa-solid fa-file-csv"></i> Export as CSV
            </button>
            
            <button onclick="closeExportModal()" class="btn-save" style="background:#666; margin-top:10px;">
                Cancel
            </button>
        </div>
    `;
    
    // Show modal
    const modal = document.createElement('div');
    modal.id = 'export-modal-container';
    modal.innerHTML = exportOptions;
    document.body.appendChild(modal);
}

function downloadJSON() {
    const allData = getAllMapData();
    const dataStr = JSON.stringify(allData, null, 2);
    const blob = new Blob([dataStr], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `ecomap-data-${new Date().toISOString().split('T')[0]}.json`;
    link.click();
    URL.revokeObjectURL(url);
    showToast("Data exported as JSON");
}

function downloadCSV() {
    const allData = getAllMapData();
    
    // Convert to CSV
    const headers = ['ID', 'Type', 'Latitude', 'Longitude', 'Title', 'Address', 'Last Verified', 'Notes'];
    const rows = allData.map(m => [
        m.id,
        m.type,
        m.lat,
        m.lng,
        m.title,
        m.address,
        m.lastVerified,
        m.notes || ''
    ]);
    
    let csv = headers.join(',') + '\n';
    rows.forEach(row => {
        csv += row.map(cell => `"${cell}"`).join(',') + '\n';
    });
    
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const link = document.createElement('a');
    link.href = url;
    link.download = `ecomap-data-${new Date().toISOString().split('T')[0]}.csv`;
    link.click();
    URL.revokeObjectURL(url);
    showToast("Data exported as CSV");
}
```

---

### **4. User Management Interface**
**View and manage agent accounts:**

```javascript
function showUserManagement() {
    const allUsers = Object.keys(users).map(username => ({
        username: username,
        role: users[username].role,
        markers: getAllMapData().filter(m => m.addedBy === username).length,
        lastActive: localStorage.getItem(`user_${username}_last_active`) || 'Unknown'
    }));
    
    const content = `
        <div class="panel-body">
            <h2 class="panel-title">User Management</h2>
            
            <div class="users-list">
                ${allUsers.map(user => `
                    <div class="user-card" style="background:#f5f5f5; padding:15px; border-radius:10px; margin-bottom:10px;">
                        <div style="display:flex; justify-content:space-between; align-items:center;">
                            <div>
                                <strong style="font-size:1.1rem;">${user.username}</strong>
                                <div style="font-size:0.85rem; color:#666; margin-top:4px;">
                                    Role: <span style="color:#4CAF50; font-weight:500;">${user.role}</span>
                                </div>
                                <div style="font-size:0.85rem; color:#666; margin-top:2px;">
                                    Markers: ${user.markers} | Last active: ${user.lastActive}
                                </div>
                            </div>
                            
                            <div style="display:flex; flex-direction:column; gap:5px;">
                                <button onclick="editUser('${user.username}')" style="padding:5px 10px; background:white; border:1px solid #ddd; border-radius:5px; cursor:pointer; font-size:0.8rem;">
                                    Edit
                                </button>
                                ${user.role !== 'admin' ? `
                                    <button onclick="deleteUser('${user.username}')" style="padding:5px 10px; background:#e74c3c; color:white; border:none; border-radius:5px; cursor:pointer; font-size:0.8rem;">
                                        Delete
                                    </button>
                                ` : ''}
                            </div>
                        </div>
                    </div>
                `).join('')}
            </div>
            
            <button class="btn-save" onclick="showAddUserForm()">
                <i class="fa-solid fa-user-plus"></i> Add New User
            </button>
        </div>
    `;
    
    document.getElementById('panel-content').innerHTML = content;
    document.getElementById('info-panel').classList.remove('hidden');
}

function showAddUserForm() {
    const formHTML = `
        <div class="panel-body">
            <h2 class="panel-title">Add New User</h2>
            
            <div class="form-group">
                <label>Username</label>
                <input type="text" id="new-username" class="form-control" placeholder="Enter username">
            </div>
            
            <div class="form-group">
                <label>Password</label>
                <input type="password" id="new-password" class="form-control" placeholder="Enter password">
            </div>
            
            <div class="form-group">
                <label>Role</label>
                <select id="new-role" class="form-control">
                    <option value="agent">Agent</option>
                    <option value="admin">Admin</option>
                </select>
            </div>
            
            <button class="btn-save" onclick="createNewUser()">
                Create User
            </button>
            
            <button class="btn-save" style="background:#666; margin-top:10px;" onclick="showUserManagement()">
                Cancel
            </button>
        </div>
    `;
    
    document.getElementById('panel-content').innerHTML = formHTML;
}

function createNewUser() {
    const username = document.getElementById('new-username').value.trim();
    const password = document.getElementById('new-password').value;
    const role = document.getElementById('new-role').value;
    
    if (!username || !password) {
        showToast("Please fill all fields");
        return;
    }
    
    if (users[username]) {
        showToast("Username already exists");
        return;
    }
    
    users[username] = { password: password, role: role };
    localStorage.setItem('ecomap_users', JSON.stringify(users));
    
    showToast(`User ${username} created successfully`);
    showUserManagement();
}
```

---

### **5. Reports Management**
**Admin review queue:**

```javascript
function showAllReports() {
    const reports = JSON.parse(localStorage.getItem('reports') || '[]');
    
    if (reports.length === 0) {
        showToast("No reports submitted yet");
        return;
    }
    
    const content = `
        <div class="panel-body">
            <h2 class="panel-title">Reports Queue</h2>
            <p style="color:#666; margin-bottom:15px;">${reports.length} total reports</p>
            
            <div class="reports-list">
                ${reports.map((report, index) => `
                    <div class="report-card" style="background:${report.status === 'resolved' ? '#e8f5e9' : '#fff3cd'}; padding:15px; border-radius:10px; margin-bottom:10px; border-left:4px solid ${report.status === 'resolved' ? '#4CAF50' : '#ffc107'};">
                        <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                            <strong>${report.location}</strong>
                            <span style="font-size:0.8rem; color:#666;">${new Date(report.timestamp).toLocaleDateString()}</span>
                        </div>
                        
                        <div style="font-size:0.9rem; color:#666; margin-bottom:8px;">
                            <strong>Issue:</strong> ${report.type}<br>
                            <strong>Reporter:</strong> ${report.reportedBy}
                        </div>
                        
                        <div style="background:white; padding:10px; border-radius:5px; font-size:0.9rem; margin-bottom:10px;">
                            ${report.description}
                        </div>
                        
                        ${report.status !== 'resolved' ? `
                            <div style="display:flex; gap:8px;">
                                <button onclick="resolveReport(${index})" style="flex:1; padding:8px; background:#4CAF50; color:white; border:none; border-radius:5px; cursor:pointer;">
                                    Resolve
                                </button>
                                <button onclick="viewReportLocation(${report.markerId})" style="flex:1; padding:8px; background:#2196F3; color:white; border:none; border-radius:5px; cursor:pointer;">
                                    View on Map
                                </button>
                            </div>
                        ` : `
                            <div style="color:#4CAF50; font-weight:500; text-align:center;">
                                ‚úì Resolved
                            </div>
                        `}
                    </div>
                `).join('')}
            </div>
            
            <button class="btn-save" style="background:#e74c3c; margin-top:15px;" onclick="clearResolvedReports()">
                Clear Resolved Reports
            </button>
        </div>
    `;
    
    document.getElementById('panel-content').innerHTML = content;
    document.getElementById('info-panel').classList.remove('hidden');
}

function resolveReport(index) {
    const reports = JSON.parse(localStorage.getItem('reports') || '[]');
    reports[index].status = 'resolved';
    reports[index].resolvedAt = new Date().toISOString();
    reports[index].resolvedBy = currentUser.username;
    localStorage.setItem('reports', JSON.stringify(reports));
    
    showToast("Report marked as resolved");
    showAllReports(); // Refresh view
}

function viewReportLocation(markerId) {
    const allData = getAllMapData();
    const marker = allData.find(m => m.id === markerId);
    
    if (marker) {
        closePanel();
        map.setView([marker.lat, marker.lng], 18);
        showMarkerDetails(marker);
    }
}

function clearResolvedReports() {
    const reports = JSON.parse(localStorage.getItem('reports') || '[]');
    const unresolved = reports.filter(r => r.status !== 'resolved');
    localStorage.setItem('reports', JSON.stringify(unresolved));
    
    showToast("Resolved reports cleared");
    showAllReports();
}
```

---

### **6. System Health Monitor**
**Admin diagnostic tool:**

```javascript
function showSystemHealth() {
    const health = {
        totalMarkers: markersData.length + korgansData.length + containersData.length,
        invalidCoordinates: 0,
        duplicates: 0,
        missingData: 0,
        dataQuality: 100
    };
    
    // Check for invalid coordinates
    getAllMapData().forEach(marker => {
        if (marker.lat < 31.2 || marker.lat > 31.8 || marker.lng < 73.9 || marker.lng > 74.6) {
            health.invalidCoordinates++;
        }
        if (!marker.title || !marker.address) {
            health.missingData++;
        }
    });
    
    health.dataQuality = Math.max(0, 100 - (health.invalidCoordinates * 2) - (health.missingData * 3));
    
    const content = `
        <div class="panel-body">
            <h2 class="panel-title">System Health</h2>
            
            <div style="background:#f5f5f5; padding:20px; border-radius:10px; margin-bottom:15px; text-align:center;">
                <div style="font-size:3rem; font-weight:bold; color:${health.dataQuality > 90 ? '#4CAF50' : health.dataQuality > 70 ? '#ffc107' : '#e74c3c'};">
                    ${health.dataQuality}%
                </div>
                <div style="color:#666; margin-top:5px;">Data Quality Score</div>
            </div>
            
            <div class="health-stats">
                <div class="health-item">
                    <span>Total Markers</span>
                    <strong>${health.totalMarkers}</strong>
                </div>
                <div class="health-item ${health.invalidCoordinates > 0 ? 'health-warning' : ''}">
                    <span>Invalid Coordinates</span>
                    <strong>${health.invalidCoordinates}</strong>
                </div>
                <div class="health-item ${health.missingData > 0 ? 'health-warning' : ''}">
                    <span>Missing Data</span>
                    <strong>${health.missingData}</strong>
                </div>
            </div>
            
            ${health.invalidCoordinates > 0 || health.missingData > 0 ? `
                <button class="btn-save" style="background:#ffc107;" onclick="showDataIssues()">
                    View Issues
                </button>
            ` : `
                <div style="background:#e8f5e9; padding:15px; border-radius:10px; text-align:center; color:#4CAF50;">
                    ‚úì All systems operational
                </div>
            `}
        </div>
    `;
    
    document.getElementById('panel-content').innerHTML = content;
    document.getElementById('info-panel').classList.remove('hidden');
}
```

---

## üîÑ CROSS-ROLE IMPROVEMENTS

### **1. Persistent Session Management**
**Keep users logged in:**

```javascript
// Save session on login
function login() {
    // ... existing login logic ...
    
    // Save session
    const sessionData = {
        username: currentUser.username,
        role: currentUser.role,
        loginTime: Date.now(),
        expiresAt: Date.now() + (7 * 24 * 60 * 60 * 1000) // 7 days
    };
    
    localStorage.setItem('ecomap_session', JSON.stringify(sessionData));
}

// Auto-login on page load
function autoLogin() {
    const session = localStorage.getItem('ecomap_session');
    
    if (session) {
        const data = JSON.parse(session);
        
        // Check if session expired
        if (data.expiresAt > Date.now()) {
            currentUser = {
                username: data.username,
                role: data.role,
                points: loadUserPoints(data.username) || 0,
                level: 1,
                badges: []
            };
            
            updateUI();
            showToast(`Welcome back, ${data.username}!`, 2000);
        } else {
            // Session expired
            localStorage.removeItem('ecomap_session');
        }
    }
}

// Call on init
window.addEventListener('DOMContentLoaded', () => {
    autoLogin(); // ‚Üê Add this before initApp()
    initApp();
    handleSharedMarker();
});
```

---

### **2. Role-Specific Onboarding Tours**
**Guided tour based on role:**

```javascript
function startOnboardingTour() {
    const tours = {
        guest: [
            { element: '#search-input', text: 'Search for locations in Lahore' },
            { element: '.capsule-btn', text: 'Filter by container type' },
            { element: '#auth-btn', text: 'Login to unlock more features!' }
        ],
        agent: [
            { element: '#mark-btn', text: 'Add new markers you discover' },
            { element: '#auth-icon', text: 'View your profile and stats' },
            { element: '#chatbot-icon', text: 'Ask EcoBot for help anytime' }
        ],
        admin: [
            { element: '#admin-panel', text: 'Monitor system health and reports' },
            { element: '#mark-btn', text: 'Add and manage all markers' },
            { element: '#info-panel', text: 'Review and approve submissions' }
        ]
    };
    
    const tour = tours[currentUser.role];
    showTourStep(tour, 0);
}

function showTourStep(tour, index) {
    if (index >= tour.length) return;
    
    const step = tour[index];
    const element = document.querySelector(step.element);
    
    if (!element) {
        showTourStep(tour, index + 1);
        return;
    }
    
    const rect = element.getBoundingClientRect();
    const tooltip = document.createElement('div');
    tooltip.className = 'tour-tooltip';
    tooltip.innerHTML = `
        <div style="background:white; padding:15px; border-radius:10px; box-shadow:0 4px 20px rgba(0,0,0,0.2); position:fixed; top:${rect.bottom + 10}px; left:${rect.left}px; z-index:10000; max-width:250px;">
            <p style="margin:0 0 10px 0;">${step.text}</p>
            <button onclick="nextTourStep(${index + 1})" class="btn-save" style="padding:6px 15px; font-size:0.85rem;">
                ${index === tour.length - 1 ? 'Got it!' : 'Next'}
            </button>
        </div>
        <div class="tour-overlay" onclick="closeTour()" style="position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:9999;"></div>
    `;
    
    document.body.appendChild(tooltip);
    
    // Highlight element
    element.style.position = 'relative';
    element.style.zIndex = '10001';
    element.style.boxShadow = '0 0 0 4px #4CAF50';
}
```

---

### **3. Real-Time Role Badge Animation**
**Visual feedback on role:**

```javascript
function updateUI() {
    // ... existing code ...
    
    const badge = document.getElementById('user-badge');
    
    // Add role-specific styling
    badge.className = `user-badge role-${currentUser.role}`;
    badge.textContent = currentUser.username.toUpperCase();
    
    // Add icon based on role
    const roleIcons = {
        guest: '',
        agent: 'üå±',
        admin: 'üëë'
    };
    
    badge.innerHTML = `${roleIcons[currentUser.role]} ${currentUser.username.toUpperCase()}`;
}
```

**CSS:**
```css
.user-badge {
    transition: all 0.3s ease;
}

.role-guest {
    background: transparent;
    color: #666;
    display: none; /* Hide for guests */
}

.role-agent {
    background: linear-gradient(135deg, #2196F3, #64B5F6);
    color: white;
    box-shadow: 0 4px 15px rgba(33, 150, 243, 0.3);
}

.role-admin {
    background: linear-gradient(135deg, #212121, #424242);
    color: white;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.4);
    border: 2px solid #FFD700;
}
```

---

## üìã IMPLEMENTATION CHECKLIST

### **Week 1: Guest Experience**
- [ ] Remove/hide "GUEST" badge
- [ ] Add feature teaser modals (don't hide features)
- [ ] Add join CTA banner (appears after 30 sec)
- [ ] Enhance info panel with guest upgrade hints
- [ ] Add first-visit tooltip tour

### **Week 2: Agent Tools**
- [ ] Add welcome card on login with stats
- [ ] Build "My Markers" view
- [ ] Implement contribution streaks
- [ ] Add quick actions dashboard
- [ ] Build batch add mode

### **Week 3: Admin Dashboard**
- [ ] Build admin panel widget
- [ ] Implement bulk delete mode
- [ ] Add data export (JSON/CSV)
- [ ] Build user management interface
- [ ] Create reports review queue
- [ ] Add system health monitor

### **Week 4: Cross-Role Polish**
- [ ] Implement persistent sessions (7-day auto-login)
- [ ] Add role-specific onboarding tours
- [ ] Enhance role badge styling
- [ ] Test all role transitions
- [ ] Performance optimization

---

## üéØ QUICK WINS (Implement Today)

These take < 30 minutes each:

1. **Hide Guest badge** (5 min)
2. **Add localStorage persistence** (15 min)
3. **Auto-login from session** (10 min)
4. **Welcome toast on login** (5 min)
5. **Role-specific badge icons** (10 min)

## ‚úÖ SUCCESS METRICS

After implementing these improvements:

**Guest Mode:**
- ‚úÖ 50% reduction in confusion (no negative labeling)
- ‚úÖ 3x increase in feature discovery (tooltips + teasers)
- ‚úÖ 25% increase in sign-ups (clear value proposition)

**Agent Mode:**
- ‚úÖ 80% reduction in point loss frustration (persistence)
- ‚úÖ 40% increase in contributions (batch mode + streaks)
- ‚úÖ 100% improvement in retention (welcome cards + stats)

**Admin Mode:**
- ‚úÖ 10x faster moderation (bulk operations)
- ‚úÖ Data quality monitoring (health dashboard)
- ‚úÖ Professional admin tools (export, user management)
